<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <title>Developer by salemove</title>

  <link rel="stylesheet" href="stylesheets/styles.css" />
  <link rel="stylesheet" href="stylesheets/pygment_trac.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<div class="wrapper">
  <header>
  </header>
<section>



<h1 id="visitor-public-api">Visitor public API.</h1>
<p>The visitor public API consist of HTTP REST endpoints, javscript, HTML, CSS API and hotlinks. The API can only be used straight in the visitor browser on the site - it cannot be used by third party services outside the site.</p>

<h2 id="headers">Headers</h2>
<p>In order to use the REST API, the request needs to include at least 3 headers: <code>Authorization&lt;</code>, <code>Accept</code> and <code>X-Salemove-Visit-Session-ID</code>.</p>

<h3 id="authorization">Authorization</h3>
<p>The request has to include the visitor’s <code>SessionId</code>. The visitor session id on the site can be retrieved by using the salemove javascript API:</p>

<pre><code>'Authorization', salemoveApi.getRequestHeaders()['Authorization']
</code></pre>

<h3 id="accept-token">Accept token</h3>

<p>The API version must be explicitly set in the request <code>Accept</code> header.</p>

<pre><code>Accept: application/vnd.salemove.v1+json
</code></pre>

<h3 id="x-salemove-visit-session-id-token">X-Salemove-Visit-Session-Id token</h3>
<p>The request also needs to include <code>X-Salemove-Visit-Session-ID</code>.</p>

<pre><code>'X-Salemove-Visit-Session-Id', salemoveApi.getRequestHeaders()['X-Salemove-Visit-Session-Id']
</code></pre>

<h3 id="full-ajax-example">Full ajax example</h3>
<p>The following is an example of a ajax request including all necessary headers.</p>

<pre><code>$.ajax({
  type: 'GET',
  url: 'https://api.salemove.com/visitor',
  headers: salemoveApi.getRequestHeaders(),
  success: function(response){
      ajaxResponse = response;
  }
});
</code></pre>

<h1 id="rest-api">REST API</h1>

<h2 id="get-current-visitor">Get current visitor</h2>

<pre><code>GET /visitor
</code></pre>

<p>Fetches the information of current visitor on the site.</p>

<ul>
  <li>
    <p>Response 200 (application/json)</p>

    <pre><code>{
  "href" =&gt; 'http://api.salemove.com/visitor',
  "name" =&gt; 'John',
  "email" =&gt; 'test@email.com',
  "phone" =&gt; '55443322',
  "note" =&gt; 'some random dude',
  "custom_attributes" =&gt; {
    "home_address" =&gt; 'Winston',
    "vip" =&gt; "true"
  }
}
</code></pre>
  </li>
</ul>

<h2 id="update-current-visitor">Update current visitor</h2>

<pre><code>POST /visitor
</code></pre>

<p>Updates the information of the current visitor on the site.</p>

<ul>
  <li>
    <p>Request body</p>

    <pre><code>}
  "name" =&gt; 'John',
  "email" =&gt; 'test@email.com',
  "phone" =&gt; '55443322',
  "note" =&gt; 'some random dude',
  "custom_attributes" =&gt; {
    "home_address" =&gt; 'Winston',
    "vip" =&gt; "true"
  }
}
</code></pre>
  </li>
  <li>
    <p>Response 200 (application/json)</p>

    <pre><code>{
  "href" =&gt; 'http://api.salemove.com/visitor',
  "name" =&gt; 'John',
  "email" =&gt; 'test@email.com',
  "phone" =&gt; '55443322',
  "note" =&gt; 'some random dude',
  "custom_attributes" =&gt; {
    "home_address" =&gt; 'Winston',
    "vip" =&gt; "true"
  }
}
</code></pre>
  </li>
</ul>

<h1 id="javascript-api">Javascript API</h1>

<h2 id="fetching-the-api">Fetching the API</h2>
<p>Fetching the API will return a <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">promise</a>. Once all SaleMove scripts have been loaded on the site, the promise will resolve and return the javascript API.</p>

<pre><code>sm.getApi().then(
    function(api){
      console.log("I got the api!", api);
      window.salemoveApi = api;
    },
    function(err){ console.log("An error occured: ", err)}
  );
</code></pre>

<h2 id="events">#EVENTS</h2>

<pre><code>ENGAGEMENT_START
ENGAGEMENT_END
</code></pre>

<p>All the available events that the SaleMove platform can fire are listed under the <code>EVENTS</code> variable.</p>

<pre><code>salemoveApi.EVENTS.ENGAGEMENT_START
</code></pre>

<h2 id="addeventlistener">#addEventListener</h2>

<pre><code>addEventListener(eventName, callback)
</code></pre>

<p>To add an event listener to the API, you can use the <code>addEventListener</code> method. The callback will be fired when SaleMove application fires the event</p>

<pre><code>salemoveApi.addEventListener(
  salemoveApi.EVENTS.ENGAGEMENT_END,
  function(args){ console.log('the engagement ended!')}
);
</code></pre>

<h2 id="removeeventlistener">#removeEventListener</h2>

<pre><code>removeEventListener(eventName, callback)
</code></pre>

<p>It is possible to remove callbacks that have been previously registered.</p>

<pre><code>salemoveApi.removeEventListener(
  salemoveApi.EVENTS.ENGAGEMENT_END,
  my_function}
);
</code></pre>

<h2 id="getrequestheaders">#getRequestHeaders</h2>

<pre><code>getRequestHeaders()
</code></pre>

<p>Returns a hash of the headers and values that are required for the visitor to authenticate with the API.</p>

<pre><code>$.ajax({
  type: 'GET',
  url: 'https://api.salemove.com/visitor',
  headers: salemoveApi.getRequestHeaders(),
  success: function(response){
      ajaxResponse = response;
  }
});
</code></pre>

<h1 id="html-and-css-api">HTML and CSS API</h1>

<h2 id="hiding-some-elements-from-the-operator">Hiding some elements from the operator</h2>

<pre><code>class: sm_cobrowsing_hidden_field
</code></pre>

<p>To hide an element for the operator during observation or cobrowsing, you can put a css class on an element.</p>

<pre><code>&lt;div class='sm_cobrowsing_hidden_field'&gt;...&lt;/div&gt;
&lt;div class='sm_cobrowsing_hidden_field other-classes'&gt;...&lt;/div&gt;
&lt;div class='other-classes sm_cobrowsing_hidden_field'&gt;...&lt;/div&gt;
&lt;input class='other-classes sm_cobrowsing_hidden_field' ...&gt;..&lt;/input&gt;
&lt;form class='other-classes sm_cobrowsing_hidden_field' ...&gt;..&lt;/form&gt;
</code></pre>

<h2 id="masking-a-field-from-the-operator">Masking a field from the operator</h2>

<pre><code>class: sm_cobrowsing_masked_field
</code></pre>

<p>To hide the value of an element for the operator during observation or cobrowsing, you can put a css class on an input. Every character that the visitor types to that field will be replaced with an asterisk <code>*</code> for the operator.</p>

<pre><code>&lt;form action="action" method="get"&gt;
First name:
&lt;input class="sm_cobrowsing_masked_field" type="text" name="first_name" /&gt;
Last name:
&lt;input class= "sm_cobrowsing_masked_field last_name_class"type="text" name="last_name" /&gt;
&lt;input type="submit" value="Submit" /&gt;
&lt;/form&gt;
</code></pre>

<h2 id="disabling-some-elements-for-the-operator">Disabling some elements for the operator</h2>

<pre><code>class: sm_cobrowsing_disabled_field
</code></pre>

<p>To disable an element for the operator during cobrowsing, to the operator cannot interact with the element, you can put a css class on an input.</p>

<pre><code>&lt;form action="action" method="get"&gt;
First name:
&lt;input class="sm_cobrowsing_disabled_field" type="text" name="first_name" /&gt;
Last name:
&lt;input class= "sm_cobrowsing_disabled_field last_name_class"type="text" name="last_name" /&gt;
&lt;input type="submit" value="Submit" /&gt;
&lt;/form&gt;
</code></pre>

<h2 id="external-button">External button</h2>

<pre><code>class: salemove-button
</code></pre>

<p>To put a SaleMove specific button on the web page that will open media-selection dialog when clicked, you can put a css class on a button or span. The button color and text can be customized by speaking with your customer success manager.</p>

<pre><code>&lt;div class='salemove-button'&gt;...&lt;/div&gt;
&lt;span class='salemove-button'&gt;...&lt;/span&gt;
</code></pre>

<h2 id="custom-element-external-button">Custom element external button</h2>

<pre><code>Attribute: data-sm-show-media-selection-on=[event]
</code></pre>

<p>To put a SaleMove specific button on the page on any type of element, not just button or span, that will trigger media-selection, use a custom javascript attribute on the element with the desired (DOM event)[http://www.w3schools.com/jsref/dom_obj_event.asp].</p>

<pre><code>link: &lt;a data-sm-show-media-selection-on="click" href="javascript:void(0);"&gt;...&lt;/a&gt;
div: &lt;div data-sm-show-media-selection-on="dblclick"&gt;&lt;h3&gt;Double-click me to start an engagement!&lt;/h3&gt;&lt;/div&gt;
</code></pre>

<h1 id="hotlink">Hotlink</h1>

<h2 id="trigger-media-selection">Trigger media selection</h2>

<pre><code>Url-hash: #sm_show_media_selection
</code></pre>

<p>To trigger a media selection dialog immediately when the page opens, put a hash at the end of the url. This can be used, for example, to open the media selection immediately after the site visitor clicks on a link and navigates to a new page.</p>

<pre><code>With site address:      http://www.site.com
The ‘hotlink' would be: http://www.site.com#sm_show_media_selection.

&lt;a href='http://www.site.com#sm_show_media_selection'&gt;...&lt;/a&gt;
</code></pre>

<h2 id="trigger-expand-reactive-tab-for-x-seconds">Trigger expand reactive tab for X seconds</h2>

<pre><code>Url-hash: #sm_show_reactive_tab_20_seconds
</code></pre>

<p>To expand the reactive tab for X seconds then the linked page opens, you can put a hash at the end of the url. This can be used, for example, to show the operator selector immediately after the visitor clicks on a link and navigates to a new page.</p>

<pre><code>With site address:      http://www.site.com
The 'hotlink' would be: http://www.site.com#sm_show_reactive_tab_20_seconds.

&lt;a href='http://www.site.com#sm_show_reactive_tab_20_seconds'&gt;...&lt;/a&gt;
</code></pre>



</section>
<aside id="sidebar">
  <h1>Visitor API</h1>
    <p class="view"><a href="https://github.com/salemove/developer">View the Project on GitHub <small>salemove/developer</small></a></p>

  <h2><a href="#" class="js-expand-btn collapsed arrow-btn" data-proofer-ignore=""></a><a href="index.html">Overview</a></h2>
  <ul class="js-guides">
    <li><a href="operator.html">Operator</a></li>
    <li><a href="visitor.html">Visitor</a></li>
  
  


      <footer>
        <p>This project is maintained by <a href="https://github.com/salemove">salemove</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>

</ul></aside></div>
