<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <title>Powered by SaleMove</title>

  <link rel="stylesheet" href="stylesheets/styles.css" />
  <link rel="stylesheet" href="stylesheets/pygment_trac.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<div class="wrapper">
  <header>
  </header>
<section>



<h1 id="visitor-public-api">Visitor public API.</h1>
<p>The visitor public API consists of HTTP REST endpoints, javscript, HTML, CSS API and hotlinks. The API can only be used straight in the visitors’ browser on the site - it cannot be used by third party services outside the site.</p>

<h2 id="headers">Headers</h2>
<p>In order to use the REST API, the request needs to include at least 3 headers: <code>Authorization</code>, <code>Accept</code> and <code>X-Salemove-Visit-Session-Id</code>.</p>

<h3 id="authorization">Authorization</h3>
<p>The request has to include the visitors’ <code>SessionId</code>. The visitor session id on the site can be retrieved by using the SaleMove javascript API:</p>

<pre><code>'Authorization', salemoveApi.getRequestHeaders()['Authorization']
</code></pre>

<h3 id="accept-token">Accept token</h3>

<p>The API version must be explicitly set in the request <code>Accept</code> header.</p>

<pre><code>Accept: application/vnd.salemove.v1+json
</code></pre>

<h3 id="x-salemove-visit-session-id-token">X-Salemove-Visit-Session-Id token</h3>
<p>The request also needs to include <code>X-Salemove-Visit-Session-Id</code>.</p>

<pre><code>'X-Salemove-Visit-Session-Id', salemoveApi.getRequestHeaders()['X-Salemove-Visit-Session-Id']
</code></pre>

<h3 id="full-ajax-example">Full ajax example</h3>
<p>The following is an example of a ajax request including all necessary headers.</p>

<pre><code>$.ajax({
  type: 'GET',
  url: 'https://api.salemove.com/visitor',
  headers: salemoveApi.getRequestHeaders(),
  success: function(response){
      ajaxResponse = response;
  }
});
</code></pre>

<h1 id="rest-api">REST API</h1>

<h2 id="get-current-visitor">Get current visitor</h2>

<pre><code>GET /visitor
</code></pre>

<p>Fetches the information of current visitor on the site.</p>

<ul>
  <li>
    <p>Response 200 (application/json)</p>

    <pre><code>{
  "href": 'http://api.salemove.com/visitor',
  "name": 'John',
  "email": 'test@email.com',
  "phone": '55443322',
  "note": 'some random dude',
  "custom_attributes": {
    # These are custom fields, which you can define yourself. Those shown below are just examples
    ...
    "home_address": 'Winston',
    "vip": "true"
  }
}
</code></pre>
  </li>
</ul>

<h2 id="update-current-visitor">Update current visitor</h2>

<pre><code>POST /visitor
</code></pre>

<p>Updates the information of the current visitor on the site. You can send custom attributes as key-value pairs to the visitor. The server treats all keys and values as strings and also returns them as strings. You cannot use nested key-value pairs.</p>

<p>The <code>note_update_method</code> parameter takes either value <code>replace</code> which replaces existing notes or value <code>append</code> which adds note to the existing notes. If this field is left out, the default <code>replace</code> value is omitted.</p>

<ul>
  <li>
    <p>Request body</p>

    <pre><code>{
  "name": 'John',
  "email": 'test@email.com',
  "phone": '55443322',
  "note": 'some random dude',
  "note_update_method": 'append',
  "custom_attributes": {
    # These are custom fields, which you can define yourself. Those shown below are just examples
    ...
    "home_address": 'Winston',
    "vip": 'true',
    "last_visited": '2014-02-18T12:24:34.420Z'
  }
}
</code></pre>
  </li>
  <li>
    <p>Response 200 (application/json)</p>

    <pre><code>{
  "href": 'http://api.salemove.com/visitor',
  "name": 'John',
  "email": 'test@email.com',
  "phone": '55443322',
  "note": 'some random dude',
  "custom_attributes": {
    # These are custom fields, which you can define yourself. Those shown below are just examples
    ...
    "home_address": 'Winston',
    "vip": 'true',
    "last_visited": '2014-02-18T12:24:34.420Z'
  }
}
</code></pre>
  </li>
</ul>

<h1 id="javascript-api">Javascript API</h1>

<h2 id="fetching-the-api">Fetching the API</h2>
<p>Fetching the API will return a <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">promise</a>. Once all SaleMove scripts have been loaded on the site, the promise will resolve and return the javascript API.</p>

<pre><code>sm.getApi().then(
    function(api){
      console.log("I got the api!", api);
      window.salemoveApi = api;
    },
    function(err){ console.log("An error occured: ", err)}
  );
</code></pre>

<h2 id="events">#EVENTS</h2>

<pre><code>ENGAGEMENT_START
ENGAGEMENT_END
</code></pre>

<p>All the available events that the SaleMove platform can fire are listed under the <code>EVENTS</code> variable.</p>

<pre><code>salemoveApi.EVENTS.ENGAGEMENT_START
</code></pre>

<h2 id="addeventlistener">#addEventListener</h2>

<pre><code>addEventListener(eventName, callback)
</code></pre>

<p>To add an event listener to the API, you can use the <code>addEventListener</code> method. The callback will be fired when SaleMove application fires the event</p>

<pre><code>salemoveApi.addEventListener(
  salemoveApi.EVENTS.ENGAGEMENT_END,
  function(args){ console.log('the engagement ended!')}
);
</code></pre>

<h2 id="removeeventlistener">#removeEventListener</h2>

<pre><code>removeEventListener(eventName, callback)
</code></pre>

<p>It is possible to remove callbacks that have been previously registered.</p>

<pre><code>salemoveApi.removeEventListener(
  salemoveApi.EVENTS.ENGAGEMENT_END,
  my_function}
);
</code></pre>

<h2 id="getrequestheaders">#getRequestHeaders</h2>

<pre><code>getRequestHeaders()
</code></pre>

<p>Returns a hash of the headers and values that are required for the visitor to authenticate with the API.</p>

<pre><code>$.ajax({
  type: 'GET',
  url: 'https://api.salemove.com/visitor',
  headers: salemoveApi.getRequestHeaders(),
  success: function(response){
      ajaxResponse = response;
  }
});
</code></pre>

<h1 id="html-and-css-api">HTML and CSS API</h1>

<h2 id="hiding-some-elements-from-the-operator">Hiding some elements from the operator</h2>

<pre><code>class: sm_cobrowsing_hidden_field
</code></pre>

<p>To hide an element for the operator during observation or cobrowsing, assign a CSS class to an element.</p>

<pre><code>&lt;div class='sm_cobrowsing_hidden_field'&gt;...&lt;/div&gt;
&lt;div class='sm_cobrowsing_hidden_field other-classes'&gt;...&lt;/div&gt;
&lt;div class='other-classes sm_cobrowsing_hidden_field'&gt;...&lt;/div&gt;
&lt;input class='other-classes sm_cobrowsing_hidden_field' ...&gt;..&lt;/input&gt;
&lt;form class='other-classes sm_cobrowsing_hidden_field' ...&gt;..&lt;/form&gt;
</code></pre>

<h2 id="masking-a-field-from-the-operator">Masking a field from the operator</h2>

<pre><code>class: sm_cobrowsing_masked_field
</code></pre>

<p>To hide the value of an element for the operator during observation or cobrowsing, assign a CSS class to an input element. Every character that the visitor types to that field will be replaced with an asterisk <code>*</code> for the operator.</p>

<pre><code>&lt;form action="action" method="get"&gt;
First name:
&lt;input class="sm_cobrowsing_masked_field" type="text" name="first_name" /&gt;
Last name:
&lt;input class="sm_cobrowsing_masked_field last_name_class" type="text" name="last_name" /&gt;
&lt;input type="submit" value="Submit" /&gt;
&lt;/form&gt;
</code></pre>

<h2 id="disabling-some-elements-for-the-operator">Disabling some elements for the operator</h2>

<pre><code>class: sm_cobrowsing_disabled_field
</code></pre>

<p>To disable an element for the operator during cobrowsing, assign a CSS class to an input element. The operator cannot interact with the element. </p>

<pre><code>&lt;form action="action" method="get"&gt;
First name:
&lt;input class="sm_cobrowsing_disabled_field" type="text" name="first_name" /&gt;
Last name:
&lt;input class="sm_cobrowsing_disabled_field last_name_class "type="text" name="last_name" /&gt;
&lt;input type="submit" value="Submit" /&gt;
&lt;/form&gt;
</code></pre>

<h2 id="external-button">External button</h2>

<pre><code>class: salemove-button
</code></pre>

<p>To put a SaleMove specific button on the web page that will open media-selection dialog when clicked, assign a CSS class to a button or span element. The button color and text can be customized by speaking with your customer success manager.</p>

<pre><code>&lt;div class='salemove-button'&gt;...&lt;/div&gt;
&lt;span class='salemove-button'&gt;...&lt;/span&gt;
</code></pre>

<h2 id="custom-element-external-button">Custom element external button</h2>

<pre><code>Attribute: data-sm-show-media-selection-on=[event]
</code></pre>

<p>To put a SaleMove specific button to the page on any type of element, not just button or span, that will trigger media-selection, use a custom javascript attribute on the element with the desired (DOM event)[http://www.w3schools.com/jsref/dom_obj_event.asp].</p>

<pre><code>link: &lt;a data-sm-show-media-selection-on="click" href="javascript:void(0);"&gt;...&lt;/a&gt;
div: &lt;div data-sm-show-media-selection-on="dblclick"&gt;&lt;h3&gt;Double-click me to start an engagement!&lt;/h3&gt;&lt;/div&gt;
</code></pre>

<h1 id="hotlink">Hotlink</h1>

<h2 id="trigger-media-selection">Trigger media selection</h2>

<pre><code>URL-hash: #sm_show_media_selection
</code></pre>

<p>To trigger the media selection dialog immediately when the page opens, put a hash at the end of the URL. This can be used, for example, to open the media selection immediately after the site visitor clicks on a link and navigates to a new page.</p>

<pre><code>With site address:      http://www.site.com
The ‘hotlink' would be: http://www.site.com#sm_show_media_selection.

&lt;a href='http://www.site.com#sm_show_media_selection'&gt;...&lt;/a&gt;
</code></pre>

<h2 id="trigger-expand-reactive-tab-for-x-seconds">Trigger expand reactive tab for X seconds</h2>

<pre><code>URL-hash: #sm_show_reactive_tab_20_seconds
</code></pre>

<p>To expand the reactive tab for X seconds when the linked page opens, put a hash at the end of the URL. This can be used, for example, to show the operator selector immediately after the visitor clicks on a link and navigates to a new page.</p>

<pre><code>With site address:      http://www.site.com
The 'hotlink' would be: http://www.site.com#sm_show_reactive_tab_20_seconds.

&lt;a href='http://www.site.com#sm_show_reactive_tab_20_seconds'&gt;...&lt;/a&gt;
</code></pre>

<h2 id="show-notification-and-save-visitor-contact-information-when-he-first-comes-to-the-page">Show notification and save visitor contact information when he first comes to the page</h2>

<pre><code>URL-hash: #sm_show_notification
Notification message: #sm_show_notification

Contact information saving:
#sm_show_notification?name=visitor+name&amp;phone=56567775&amp;email=visitor@email.com&amp;note=visitor+note&amp;custom_attributes[attribute1]=attribute1+value&amp;custom_attributes[attribute2]=attribute2+value

Both notification and contact information saving:
#sm_show_notification?message=some+message&amp;name=visitor+name&amp;phone=56567775&amp;email=visitor@email.com&amp;note=visitor+note&amp;custom_attributes[attribute1]=attribute1+value&amp;custom_attributes[attribute2]=attribute2+value
</code></pre>

<p>To immediately show a notification to operators, or save visitors’ contact information when the visitor comes to the site, you can put the hash at the end of the URL. This can be used, for example for high-profile clients who should be contacted immediately after they come to the page and some information about them can already be pre-filled.</p>

<p>The query parameters should be put after the URL-hash, separated with the question mark <strong>’?’</strong> sign from the URL-hash. When using multiple parameters, separate them with the ampersand <strong>‘&amp;’</strong> sign.</p>

<p>When you want to <strong>use spaces</strong> in parameter values, you <strong>need to replace spaces with ‘+’ or ‘%20’ signs</strong>. The ‘+’ or ‘%20’ signs will be replaced with spaces automatically.</p>

<p>If some or all contact information parameters are missing, then missing values will not be updated. If no message is given, then a default message will be used for notification.</p>

<p>The explanation of parameters is as follows:</p>

<pre><code>?message=some+message+to+show+to+the+operator # This message is shown to the operator.
?name=Visitor+Name # This name will be saved as the visitor name
?email=visitor@email.com # This email will be saved as the visitor email
?phone=56565677 # This phone will be saved as the visitors' phone
?note=Some+note+about+the+visitor # This note will be appended to the existing visitors' note.

# You can save custom information about the visitor as specified in the 'Update current visitor' section. Each attribute key must be put inside brackets and multiple custom attributes must be separated with the ampersand '&amp;' sign as other parameters.
?custom_attributes[attribute1]=attribute1+value&amp;custom_attributes[attribute2]=attribute2+value
</code></pre>



</section>
<aside id="sidebar">
  <h1>Visitor API</h1>
    <p class="view"><a href="https://github.com/salemove/developer">View the Project on GitHub <small>salemove/developer</small></a></p>

  <h2><a href="#" class="js-expand-btn collapsed arrow-btn" data-proofer-ignore=""></a><a href="index.html">Overview</a></h2>
  <ul class="js-guides">
    <li><a href="operator.html">Operator</a></li>
    <li><a href="visitor.html">Visitor</a></li>
  
  


      <footer>
        <p>This project is maintained by <a href="https://github.com/salemove">SaleMove</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>

</ul></aside></div>
