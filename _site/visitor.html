<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1" />
  <title>Developer by salemove</title>

  <link rel="stylesheet" href="stylesheets/styles.css" />
  <link rel="stylesheet" href="stylesheets/pygment_trac.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <!--[if lt IE 9]>
  <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
</head>

<div class="wrapper">
  <header>
  </header>
<section>



<h1 id="visitor-public-api">Visitor public API.</h1>
<p>The visitor public API includes a set of HTTP REST endpoints and javscript API. The API can only be used from the visitor browser on the site - it cannot be used by third party services outside the site.</p>

<h2 id="headers">Headers</h2>
<p>In order to use the REST API, the request needs to include at least 3 headers: <code>Authorization&lt;</code>, <code>Accept</code> and <code>X-Salemove-Visit-Session-ID</code>.</p>

<h3 id="authorization">Authorization</h3>
<p>The request has to include the visitorâ€™s <code>SessionId</code>. The visitor session id on the site can be retrieved by using the salemove javascript API:</p>

<pre><code>'Authorization', salemoveApi.getRequestHeaders()['Authorization']
</code></pre>

<h3 id="accept-token">Accept token</h3>

<p>The API version must be explicitly set in the request <code>Accept</code> header.</p>

<pre><code>Accept: application/vnd.salemove.v1+json
</code></pre>

<h3 id="x-salemove-visit-session-id-token">X-Salemove-Visit-Session-Id token</h3>
<p>The request also needs to include <code>X-Salemove-Visit-Session-ID</code>.</p>

<pre><code>'X-Salemove-Visit-Session-Id', salemoveApi.getRequestHeaders()['X-Salemove-Visit-Session-Id']
</code></pre>

<h3 id="full-ajax-example">Full ajax example</h3>
<p>The following is an example of a ajax request including all necessary headers.</p>

<pre><code>$.ajax({
  type: 'GET',
  url: 'https://api.salemove.com/visitor',
  headers: salemoveApi.getRequestHeaders(),
  success: function(response){
      ajaxResponse = response;
  }
});
</code></pre>

<h1 id="rest-api">REST API</h1>

<h2 id="get-current-visitor">Get current visitor</h2>

<pre><code>GET /visitor
</code></pre>

<p>Fetches the information of current visitor on the site.</p>

<ul>
  <li>
    <p>Response 200 (application/json)</p>

    <pre><code>{
  "href" =&gt; 'http://api.salemove.com/visitor',
  "name" =&gt; 'John',
  "email" =&gt; 'test@email.com',
  "phone" =&gt; '55443322',
  "note" =&gt; 'some random dude',
  "custom_attributes" =&gt; {
    "home_address" =&gt; 'Winston',
    "vip" =&gt; "true"
  }
}
</code></pre>
  </li>
</ul>

<h2 id="update-current-visitor">Update current visitor</h2>

<pre><code>POST /visitor
</code></pre>

<p>Updates the information of the current visitor on the site.</p>

<ul>
  <li>
    <p>Request body</p>

    <pre><code>}
  "name" =&gt; 'John',
  "email" =&gt; 'test@email.com',
  "phone" =&gt; '55443322',
  "note" =&gt; 'some random dude',
  "custom_attributes" =&gt; {
    "home_address" =&gt; 'Winston',
    "vip" =&gt; "true"
  }
}
</code></pre>
  </li>
  <li>
    <p>Response 200 (application/json)</p>

    <pre><code>{
  "href" =&gt; 'http://api.salemove.com/visitor',
  "name" =&gt; 'John',
  "email" =&gt; 'test@email.com',
  "phone" =&gt; '55443322',
  "note" =&gt; 'some random dude',
  "custom_attributes" =&gt; {
    "home_address" =&gt; 'Winston',
    "vip" =&gt; "true"
  }
}
</code></pre>
  </li>
</ul>

<h1 id="javascript-api">Javascript API</h1>

<h2 id="fetching-the-api">Fetching the API</h2>
<p>Fetching the API will return a <a href="http://www.html5rocks.com/en/tutorials/es6/promises/">promise</a>. Once all SaleMove scripts have been loaded on the site, the promise will resolve and return the javascript API.</p>

<pre><code>sm.getApi().then(
    function(api){
      console.log("I got the api!", api);
      window.salemoveApi = api;
    },
    function(err){ console.log("An error occured: ", err)}
  );
</code></pre>

<h2 id="events">#EVENTS</h2>

<pre><code>ENGAGEMENT_START
ENGAGEMENT_END
</code></pre>

<p>All the available events that the SaleMove platform can fire are listed under the <code>EVENTS</code> variable.</p>

<pre><code>salemoveApi.EVENTS.ENGAGEMENT_START
</code></pre>

<h2 id="addeventlistener">#addEventListener</h2>

<pre><code>addEventListener(eventName, callback)
</code></pre>

<p>To add an event listener to the API, you can use the <code>addEventListener</code> method. The callback will be fired when SaleMove application fires the event</p>

<pre><code>salemoveApi.addEventListener(
  salemoveApi.EVENTS.ENGAGEMENT_END,
  function(args){ console.log('the engagement ended!')}
);
</code></pre>

<h2 id="removeeventlistener">#removeEventListener</h2>

<pre><code>removeEventListener(eventName, callback)
</code></pre>

<p>It is possible to remove callbacks that have been previously registered.</p>

<pre><code>salemoveApi.removeEventListener(
  salemoveApi.EVENTS.ENGAGEMENT_END,
  my_function}
);
</code></pre>

<h2 id="getrequestheaders">#getRequestHeaders</h2>

<pre><code>getRequestHeaders()
</code></pre>

<p>Returns a hash of the headers and values that are required for the visitor to authenticate with the API.</p>

<pre><code>$.ajax({
  type: 'GET',
  url: 'https://api.salemove.com/visitor',
  headers: salemoveApi.getRequestHeaders(),
  success: function(response){
      ajaxResponse = response;
  }
});
</code></pre>


</section>
<aside id="sidebar">
  <h1>Visitor API</h1>
    <p class="view"><a href="https://github.com/salemove/developer">View the Project on GitHub <small>salemove/developer</small></a></p>

  <h2><a href="#" class="js-expand-btn collapsed arrow-btn" data-proofer-ignore=""></a><a href="index.html">Overview</a></h2>
  <ul class="js-guides">
    <li><a href="operator.html">Operator</a></li>
    <li><a href="visitor.html">Visitor</a></li>
  
  


      <footer>
        <p>This project is maintained by <a href="https://github.com/salemove">salemove</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>

</ul></aside></div>
